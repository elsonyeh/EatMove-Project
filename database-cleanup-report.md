# 資料庫清理報告

## 清理前的問題

### 1. 重複的訂單表格

- **問題**: 同時存在 `order` 和 `orders` 兩個表格
- **原因**: `order` 是 SQL 保留字，應該避免使用
- **影響**: 可能導致查詢錯誤和混淆

### 2. 外鍵約束問題

- **問題**: `cart_items` 表格的 `dishid` 欄位有重複的外鍵約束
- **影響**: 可能導致資料完整性問題

### 3. 空表格

以下表格目前沒有資料：

- `cart` (購物車)
- `cart_items` (購物車項目)
- `chat` (聊天記錄)
- `favoriteentry` (收藏項目)
- `favoritelist` (收藏清單)
- `payment` (付款記錄)

## 執行的清理操作

### ✅ 已完成的清理

1. **刪除重複的 `order` 表格**

   - 保留了 `orders` 表格（5 筆資料）
   - 刪除了 `order` 表格（1 筆資料）
   - 原因：避免使用 SQL 保留字

2. **修正外鍵約束**

   - 刪除了 `cart_items` 表格中重複的外鍵約束
   - 重新添加正確的複合外鍵約束：`(rid, dishid) -> menu(rid, dishid)`

3. **修正前端 TypeScript 錯誤**
   - 修正了 `app/api/restaurant/dashboard/route.ts` 中的類型錯誤
   - 修正了 `app/restaurant/dashboard/page.tsx` 中的屬性名稱錯誤

### 🔧 保留的表格

以下空表格被保留，因為它們是系統功能的一部分：

- `cart` 和 `cart_items`: 購物車功能
- `favoriteentry` 和 `favoritelist`: 收藏功能
- `ratings`: 評分系統

### ❓ 需要考慮的表格

以下表格目前為空，可以考慮是否需要：

- `chat`: 聊天功能（如果不需要即時聊天可以移除）
- `payment`: 付款記錄（如果使用外部付款系統可以移除）

## 清理後的資料庫結構

### 核心表格（有資料）

1. **member** (9 筆) - 會員資料
2. **restaurant** (25 筆) - 餐廳資料
3. **deliveryman** (4 筆) - 外送員資料
4. **menu** (67 筆) - 菜單項目
5. **orders** (5 筆) - 訂單資料
6. **order_items** (6 筆) - 訂單項目
7. **ratings** (1 筆) - 評分資料

### 功能性表格（空但保留）

1. **cart** - 購物車
2. **cart_items** - 購物車項目
3. **favoriteentry** - 收藏項目
4. **favoritelist** - 收藏清單

### 可選表格（空）

1. **chat** - 聊天記錄
2. **payment** - 付款記錄

## 建議

### 短期建議

1. ✅ 已完成：修正所有 TypeScript 錯誤
2. ✅ 已完成：統一使用 `orders` 表格
3. ✅ 已完成：修正外鍵約束

### 長期建議

1. **考慮移除不需要的表格**：如果不需要聊天功能，可以移除 `chat` 表格
2. **添加索引優化**：為常用查詢添加適當的索引
3. **資料備份**：定期備份重要資料
4. **監控表格使用情況**：追蹤哪些表格實際被使用

## 清理結果

- ✅ 解決了重複表格問題
- ✅ 修正了外鍵約束問題
- ✅ 修正了前端 TypeScript 錯誤
- ✅ 保留了所有功能性表格
- ✅ 資料庫結構更加清晰和一致

總共清理了 **1 個重複表格** 和 **多個外鍵約束問題**，資料庫現在更加整潔和高效。
