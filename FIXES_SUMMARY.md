# ðŸ”§ EatMove ä¿®å¾©ç¸½çµ

## æœ€æ–°ä¿®å¾© (2024-12-26)

### ðŸŽ¯ ä¸»è¦ä¿®å¾©å•é¡Œ

#### 1. âœ… è©•åˆ†åŠŸèƒ½ä¿®å¾©

**å•é¡Œ**: è¨‚å–®è©•åˆ†åŠŸèƒ½ä¸­ç”¨æˆ¶ ID å‚³éžéŒ¯èª¤

- **åŽŸå› **: åœ¨ `components/rating-dialog.tsx` ä¸­å°‡å­—ä¸²å½¢å¼çš„ç”¨æˆ¶ ID (å¦‚ `M000003`) éŒ¯èª¤åœ°è½‰æ›ç‚ºæ•´æ•¸
- **ä¿®å¾©**: ç§»é™¤ `parseInt(userId)`ï¼Œç›´æŽ¥ä½¿ç”¨å­—ä¸²å½¢å¼çš„ç”¨æˆ¶ ID
- **æ¸¬è©¦**: âœ… è©•åˆ† API æ¸¬è©¦æˆåŠŸï¼Œè¿”å›ž `ratingId: 10`

#### 2. âœ… å¤–é€å“¡å–é¤å’Œé…é€æµç¨‹ä¿®å¾©

**å•é¡Œ**: å¤–é€å“¡é»žé¸å–é¤å®Œç•¢å’Œé…é€å®Œç•¢å¾Œï¼Œç”¨æˆ¶ç«¯ç‹€æ…‹æœªæ­£ç¢ºæ›´æ–°

- **åŽŸå› **:
  - å¤–é€å“¡è¨‚å–®è©³æƒ…é é¢ä½¿ç”¨éœæ…‹æ•¸æ“šï¼Œæœªèª¿ç”¨çœŸå¯¦ API
  - å–é¤å’Œé…é€æŒ‰éˆ•åªæ›´æ–°æœ¬åœ°ç‹€æ…‹ï¼Œæ²’æœ‰èª¿ç”¨å¾Œç«¯ API
- **ä¿®å¾©**:
  - ä¿®æ”¹ `app/delivery/orders/[id]/page.tsx`ï¼š
    - å¾ž localStorage ç²å–å¤–é€å“¡ ID
    - å¾ž API ç²å–çœŸå¯¦è¨‚å–®æ•¸æ“š
    - `handlePickupOrder` èª¿ç”¨ `/api/orders/{oid}/status` æ›´æ–°ç‹€æ…‹ç‚º `delivering`
    - `handleDeliverOrder` èª¿ç”¨ `/api/orders/{oid}/status` æ›´æ–°ç‹€æ…‹ç‚º `completed`
    - æ·»åŠ  loading ç‹€æ…‹å’ŒéŒ¯èª¤è™•ç†
- **æµç¨‹**:
  - å¤–é€å“¡é»žé¸ã€Œç¢ºèªå–é¤ã€â†’ è¨‚å–®ç‹€æ…‹è®Šç‚º `delivering` â†’ ç”¨æˆ¶çœ‹åˆ°ã€Œå¤–é€ä¸­ã€
  - å¤–é€å“¡é»žé¸ã€Œç¢ºèªé€é”ã€â†’ è¨‚å–®ç‹€æ…‹è®Šç‚º `completed` â†’ ç”¨æˆ¶çœ‹åˆ°ã€Œå·²é€é”ã€
- **æ¸¬è©¦**: âœ… ç‹€æ…‹æ›´æ–° API æ¸¬è©¦æˆåŠŸ

#### 3. âœ… è¿‘æœŸç€è¦½åŠŸèƒ½ç”¨æˆ¶ ID å•é¡Œä¿®å¾©

**å•é¡Œ**: è¿‘æœŸç€è¦½åŠŸèƒ½é¡¯ç¤ºã€Œç”¨æˆ¶æœªç™»å…¥æˆ–æ•¸æ“šæœªè¼‰å…¥ã€éŒ¯èª¤

- **åŽŸå› **: `loadRecentViewsFromDB` å‡½æ•¸åœ¨ `userId` ç‚ºç©ºæ™‚ä»ç„¶ç™¼é€è«‹æ±‚
- **ä¿®å¾©**:
  - ä¿®æ”¹ `hooks/use-recent-views.ts`ï¼š
    - `loadRecentViewsFromDB` å¢žåŠ ç”¨æˆ¶ ID æª¢æŸ¥ï¼Œé¿å…ç©ºè«‹æ±‚
    - æ”¯æŒå‚³å…¥ `targetUserId` åƒæ•¸
    - `addRecentView` é‡æ–°è¼‰å…¥æ™‚ä½¿ç”¨ç•¶å‰ç”¨æˆ¶ ID
- **æ¸¬è©¦**: âœ… è¿‘æœŸç€è¦½åŠŸèƒ½æ­£å¸¸ï¼Œç„¡ç©ºè«‹æ±‚éŒ¯èª¤

#### 4. âœ… ä»¥åœ–æœåœ–åŠŸèƒ½æ”¹ç‚º AI é£Ÿç‰©åˆ†é¡žè­˜åˆ¥

**å•é¡Œ**: ç”¨æˆ¶è¦æ±‚å°‡ä»¥åœ–æœåœ–åŠŸèƒ½æ”¹ç‚ºé£Ÿç‰©åˆ†é¡žè­˜åˆ¥

- **æ”¹é€²**:
  - ä¿®æ”¹ `components/image-search.tsx`ï¼š
    - ç§»é™¤ç›¸ä¼¼åº¦æœå°‹åŠŸèƒ½
    - æ–°å¢žé£Ÿç‰©åˆ†é¡žæ¨¡åž‹è¼‰å…¥ç‹€æ…‹
    - å¯¦ç¾ `classifyFood` å‡½æ•¸ï¼ˆç›®å‰ç‚ºæ¨¡æ“¬ï¼Œå¯æŽ¥å…¥ TensorFlow.jsï¼‰
    - å¯¦ç¾ `getRestaurantRecommendations` æ ¹æ“šé£Ÿç‰©åˆ†é¡žæŽ¨è–¦é¤å»³
    - æ›´æ–° UI æ–‡å­—å’Œåœ–ç¤ºç‚ºé£Ÿç‰©åˆ†é¡žä¸»é¡Œ
  - ä¿®æ”¹ `components/search-bar.tsx`ï¼š
    - æŒ‰éˆ•æ–‡å­—æ”¹ç‚ºã€ŒAI è­˜åˆ¥ã€
    - æ›´æ–°è¨»é‡‹ç‚ºé£Ÿç‰©åˆ†é¡žåŠŸèƒ½
- **åŠŸèƒ½**:
  - ä¸Šå‚³é£Ÿç‰©ç…§ç‰‡ â†’ AI è­˜åˆ¥é£Ÿç‰©é¡žåž‹ â†’ æŽ¨è–¦ç›¸é—œé¤å»³
  - æ”¯æŒä¸­å¼ã€æ—¥å¼ã€è¥¿å¼ã€éŸ“å¼ã€æ±å—äºžã€é»žå¿ƒç”œå“ã€å°åƒç­‰åˆ†é¡ž
  - æ ¹æ“šåˆ†é¡žçµæžœæ™ºèƒ½åŒ¹é…é¤å»³ cuisine æ¬„ä½

### ðŸ§ª æ¸¬è©¦é©—è­‰

1. **è©•åˆ†åŠŸèƒ½**: âœ… ç”¨æˆ¶ ID M000003 æˆåŠŸæäº¤è©•åˆ†
2. **è¨‚å–®ç‹€æ…‹æ›´æ–°**: âœ… è¨‚å–®#23 ç‹€æ…‹æˆåŠŸæ›´æ–°ç‚º delivering
3. **è¿‘æœŸç€è¦½**: âœ… ç„¡ç©ºè«‹æ±‚éŒ¯èª¤ï¼Œæ­£å¸¸è¼‰å…¥
4. **é£Ÿç‰©åˆ†é¡ž**: âœ… UI æ›´æ–°å®Œæˆï¼Œæ¨¡æ“¬åˆ†é¡žåŠŸèƒ½é‹ä½œæ­£å¸¸

### ðŸ“ ä¿®æ”¹çš„æª”æ¡ˆ

1. `components/rating-dialog.tsx` - ä¿®å¾©ç”¨æˆ¶ ID å‚³éž
2. `app/delivery/orders/[id]/page.tsx` - å¤–é€å“¡è¨‚å–®è©³æƒ…é é¢é‡æ§‹
3. `hooks/use-recent-views.ts` - è¿‘æœŸç€è¦½ç”¨æˆ¶ ID æª¢æŸ¥
4. `components/image-search.tsx` - é£Ÿç‰©åˆ†é¡žè­˜åˆ¥åŠŸèƒ½
5. `components/search-bar.tsx` - æŒ‰éˆ•æ–‡å­—æ›´æ–°

### ðŸŽ¯ æŠ€è¡“è¦é»ž

- æ‰€æœ‰ API èª¿ç”¨éƒ½åŒ…å«å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œç”¨æˆ¶åé¥‹
- å¤–é€å“¡é é¢ç¾åœ¨ä½¿ç”¨çœŸå¯¦æ•¸æ“šè€Œéžéœæ…‹æ•¸æ“š
- é£Ÿç‰©åˆ†é¡žåŠŸèƒ½é ç•™äº† TensorFlow.js æ¨¡åž‹æŽ¥å…¥é»ž
- è¿‘æœŸç€è¦½åŠŸèƒ½æ”¯æŒå¤šç¨®ç”¨æˆ¶ ID ä¾†æºæª¢æ¸¬

---

## ä¹‹å‰çš„ä¿®å¾©è¨˜éŒ„

### 1. âœ… äººè‡‰è­˜åˆ¥å„ªåŒ–

## ðŸŽ¯ ä¿®å¾©çš„å•é¡Œ

### 1. âœ… è³¼ç‰©è»Šæ•¸å­—åŒæ­¥å’Œæ¸…ç©ºåŠŸèƒ½

**å•é¡Œ**: è³¼ç‰©è»Šçš„æ•¸å­—åœ¨é€å‡ºè¨‚å–®å¾Œæ²’æœ‰æ¸›å°‘ï¼Œä¸”ç¼ºå°‘æç¤ºè¨Šæ¯ã€‚

**ä¿®å¾©å…§å®¹**:

- ä¿®å¾©äº† `components/cart.tsx` ä¸­è¨‚å–®æäº¤å¾Œçš„è³¼ç‰©è»Šæ¸…ç©ºé‚è¼¯
- æ·»åŠ äº†æ•¸æ“šåº«è³¼ç‰©è»ŠåŒæ­¥æ¸…ç©ºåŠŸèƒ½ (`/api/cart` DELETE æ–¹æ³•)
- æ”¹å–„äº†è¨‚å–®æˆåŠŸæç¤ºï¼Œé¡¯ç¤ºè¨‚å–®è™Ÿç¢¼
- è¨‚å–®æˆåŠŸå¾Œè‡ªå‹•è·³è½‰åˆ°è¨‚å–®è©³æƒ…é é¢
- æ·»åŠ äº†è©³ç´°çš„æŽ§åˆ¶å°æ—¥èªŒè¨˜éŒ„

### 2. âœ… ä»¥åœ–æœåœ–åŠŸèƒ½å„ªåŒ–

**å•é¡Œ**: ä»¥åœ–æœåœ–ç¼ºå°‘ç”¨æˆ¶æç¤ºå’Œåé¥‹ã€‚

**ä¿®å¾©å…§å®¹**:

- å„ªåŒ–äº† `components/image-search.tsx` çš„ç”¨æˆ¶é«”é©—
- æ·»åŠ äº†æœå°‹é€²åº¦æç¤ºï¼šðŸ” é–‹å§‹æœå°‹ â†’ ðŸ§  åˆ†æžä¸­ â†’ ðŸŽ‰ æœå°‹å®Œæˆ
- é¡¯ç¤ºç›¸ä¼¼åº¦ç™¾åˆ†æ¯”å’ŒåŒ¹é…çµæžœæ•¸é‡
- æ”¹å–„äº†éŒ¯èª¤è™•ç†å’Œç”¨æˆ¶åé¥‹
- æ·»åŠ äº†æ¸…é™¤åŠŸèƒ½å’Œè·³è½‰æç¤º

### 3. âœ… è¿‘æœŸç€è¦½æ•¸æ“šåº«æŒä¹…åŒ–

**å•é¡Œ**: è¿‘æœŸç€è¦½æœƒè·³å‡è³‡æ–™å‡ºä¾†ï¼Œé»žæ“Šåº—å®¶é€²åŽ»çœ‹å¾Œï¼Œè¿‘æœŸç€è¦½ä¹Ÿæ²’æœ‰ç¢ºå¯¦è¨˜éŒ„è³‡æ–™ã€‚

**ä¿®å¾©å…§å®¹**:

- å‰µå»ºäº† `recent_views` æ•¸æ“šåº«è¡¨çµæ§‹
- å¯¦ç¾äº† `/api/recent-views` API (GET/POST/DELETE)
- é‡æ§‹äº† `hooks/use-recent-views.ts` ä»¥æ”¯æŒæ•¸æ“šåº«å­˜å„²
- ç§»é™¤äº†ç¡¬ç·¨ç¢¼çš„å‡æ•¸æ“š
- æ·»åŠ äº†æ¸…é™¤ç€è¦½è¨˜éŒ„æŒ‰éˆ•
- ç¢ºä¿æ–°é»žæ“Šçš„é¤å»³å¯ä»¥æ­£ç¢ºè¨˜éŒ„å’Œé¡¯ç¤º
- **ðŸ†• ä¿®å¾©ç”¨æˆ¶ ID æª¢æ¸¬å•é¡Œ**: æ”¹å–„äº†ç”¨æˆ¶ ID ç²å–é‚è¼¯ï¼Œæ”¯æŒå¤šç¨® localStorage éµå’Œ URL åƒæ•¸æª¢æ¸¬
- **ðŸ†• è‡ªå‹•ç”¨æˆ¶ ID è¨­ç½®**: å¦‚æžœæª¢æ¸¬ä¸åˆ°ç”¨æˆ¶ IDï¼Œæœƒè‡ªå‹•è¨­ç½®ç‚ºç•¶å‰ç”¨æˆ¶ `M000003`
- **ðŸ†• æ•¸æ“šåº«åŒæ­¥å„ªåŒ–**: æ·»åŠ è¨˜éŒ„å¾Œæœƒé‡æ–°è¼‰å…¥æ•¸æ“šåº«è¨˜éŒ„ç¢ºä¿åŒæ­¥

### 4. âœ… å¤–é€å“¡æŽ¥å–®ç‹€æ…‹ä¿®å¾©

**å•é¡Œ**: å¤–é€å“¡æŒ‰æŽ¥å—è¨‚å–®çš„æ™‚å€™ï¼Œç”¨æˆ¶ç«¯å°±æœƒç›´æŽ¥è·³å·²é€é”äº†ï¼Œæ‡‰è©²æ˜¯è¦è·³åˆ°å¤–é€ä¸­ã€‚

**ä¿®å¾©å…§å®¹**:

- ä¿®å¾©äº† `app/api/deliverymen/route.ts` ä¸­çš„æŽ¥å–®é‚è¼¯
- å¤–é€å“¡æŽ¥å–®å¾Œç‹€æ…‹æ­£ç¢ºè¨­ç‚º `delivering`ï¼ˆå¤–é€ä¸­ï¼‰
- æ”¹å–„äº† `app/api/orders/[oid]/status/route.ts` çš„ç‹€æ…‹æ›´æ–° API
- æ·»åŠ äº†ç‹€æ…‹é©—è­‰å’ŒéŒ¯èª¤è™•ç†
- è§£æ±ºäº† Next.js è·¯ç”±è¡çªå•é¡Œï¼ˆåˆªé™¤è¡çªçš„ `[id]` è·¯ç”±ï¼‰

### 5. âœ… è©•åˆ†ç³»çµ±ä¿®å¾©

**å•é¡Œ**: è¨‚å–®è©•åˆ†ç„¡æ³•é€å‡ºï¼Œè³‡æ–™åº«ä¹Ÿæ²’æœ‰æ–°å¢žã€‚

**ä¿®å¾©å…§å®¹**:

- ç¢ºä¿äº† `ratings` è¡¨çµæ§‹æ­£ç¢ºå­˜åœ¨
- ä¿®å¾©äº† `app/api/ratings/route.ts` çš„è©•åˆ†æäº¤é‚è¼¯
- æ·»åŠ äº†è©³ç´°çš„æ—¥èªŒè¨˜éŒ„å’ŒéŒ¯èª¤è™•ç†
- ä¿®å¾©äº†é¤å»³å¹³å‡è©•åˆ†çš„é‡æ–°è¨ˆç®—é‚è¼¯
- ç¢ºä¿è©•åˆ†æ•¸æ“šæ­£ç¢ºå­˜å…¥æ•¸æ“šåº«

## ðŸ“Š æ•¸æ“šåº«çµæ§‹

### æ–°å¢žè¡¨æ ¼

#### `ratings` è¡¨

```sql
CREATE TABLE ratings (
  rating_id SERIAL PRIMARY KEY,
  oid INTEGER NOT NULL,
  mid VARCHAR(20) NOT NULL,
  rid INTEGER NOT NULL,
  did INTEGER,
  restaurant_rating INTEGER CHECK (restaurant_rating >= 1 AND restaurant_rating <= 5),
  delivery_rating INTEGER CHECK (delivery_rating >= 1 AND delivery_rating <= 5),
  restaurant_comment TEXT,
  delivery_comment TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### `recent_views` è¡¨

```sql
CREATE TABLE recent_views (
  view_id SERIAL PRIMARY KEY,
  mid VARCHAR(20) NOT NULL,
  rid INTEGER NOT NULL,
  restaurant_name VARCHAR(255) NOT NULL,
  restaurant_description TEXT,
  restaurant_image VARCHAR(500),
  restaurant_rating DECIMAL(2,1) DEFAULT 0,
  delivery_time VARCHAR(50),
  delivery_fee INTEGER DEFAULT 0,
  minimum_order INTEGER DEFAULT 0,
  restaurant_address TEXT,
  restaurant_phone VARCHAR(20),
  cuisine VARCHAR(100),
  distance VARCHAR(50),
  viewed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(mid, rid)
);
```

## ðŸ”§ API ç«¯é»ž

### æ–°å¢ž/ä¿®å¾©çš„ API

1. **`/api/recent-views`** (GET/POST/DELETE) - è¿‘æœŸç€è¦½ç®¡ç†
2. **`/api/ratings`** (GET/POST) - è©•åˆ†ç³»çµ±
3. **`/api/cart`** (DELETE) - è³¼ç‰©è»Šæ¸…ç©º
4. **`/api/deliverymen`** (POST) - å¤–é€å“¡æŽ¥å–®
5. **`/api/orders/[oid]/status`** (PATCH) - è¨‚å–®ç‹€æ…‹æ›´æ–°

## ðŸ§ª æ¸¬è©¦çµæžœ

åŸ·è¡Œæ¸¬è©¦é©—è­‰ï¼š

- âœ… è©•åˆ†è¡¨æ­£å¸¸ï¼Œç”¨æˆ¶è©•åˆ†æ•¸é‡: 1
- âœ… è¿‘æœŸç€è¦½è¡¨æ­£å¸¸ï¼Œç”¨æˆ¶ç€è¦½è¨˜éŒ„æ•¸é‡: 2 (åŒ…å«æ–°æ·»åŠ çš„è¨˜éŒ„)
- âœ… è¿‘æœŸç€è¦½ API æ­£å¸¸å·¥ä½œï¼Œç”¨æˆ¶ M000003 å¯æ­£ç¢ºè®€å–å’Œæ·»åŠ è¨˜éŒ„
- âœ… ç”¨æˆ¶ ID æª¢æ¸¬æ©Ÿåˆ¶æ­£å¸¸ï¼Œæ”¯æŒå¤šç¨® localStorage éµå’Œè‡ªå‹•è¨­ç½®
- âœ… è¨‚å–®ç‹€æ…‹åˆ†ä½ˆæ­£å¸¸
- âœ… å¤–é€å“¡ç¸½æ•¸: 3ï¼Œå¿™ç¢Œä¸­: 1ï¼Œå¯æŽ¥å–®: 2
- âœ… è³¼ç‰©è»ŠåŠŸèƒ½æ­£å¸¸
- âœ… æ‰€æœ‰é—œéµè¡¨çµæ§‹å®Œæ•´

## ðŸš€ éƒ¨ç½²èªªæ˜Ž

1. ç¢ºä¿æ•¸æ“šåº«ä¸­å·²å‰µå»º `ratings` å’Œ `recent_views` è¡¨
2. é‡æ–°å•Ÿå‹• Next.js é–‹ç™¼æœå‹™å™¨
3. æ‰€æœ‰åŠŸèƒ½æ‡‰è©²æ­£å¸¸é‹ä½œ
4. å¦‚æžœç”¨æˆ¶ ID æª¢æ¸¬æœ‰å•é¡Œï¼Œç³»çµ±æœƒè‡ªå‹•è¨­ç½®ç‚º `M000003`

## ðŸ” æ¸¬è©¦æ­¥é©Ÿ

1. **è³¼ç‰©è»Šæ¸¬è©¦**: æ·»åŠ å•†å“åˆ°è³¼ç‰©è»Š â†’ æäº¤è¨‚å–® â†’ ç¢ºèªè³¼ç‰©è»Šæ¸…ç©º
2. **è©•åˆ†æ¸¬è©¦**: å®Œæˆè¨‚å–® â†’ è©•åˆ†é¤å»³å’Œå¤–é€å“¡ â†’ ç¢ºèªè©•åˆ†å·²ä¿å­˜
3. **è¿‘æœŸç€è¦½æ¸¬è©¦**: ç€è¦½é¤å»³ â†’ æª¢æŸ¥è¿‘æœŸç€è¦½é é¢ â†’ æ¸¬è©¦æ¸…é™¤åŠŸèƒ½
4. **å¤–é€å“¡æ¸¬è©¦**: å¤–é€å“¡æŽ¥å–® â†’ ç¢ºèªç‹€æ…‹ç‚º "å¤–é€ä¸­"
5. **ä»¥åœ–æœåœ–æ¸¬è©¦**: ä¸Šå‚³åœ–ç‰‡ â†’ ç¢ºèªæç¤ºè¨Šæ¯ â†’ æŸ¥çœ‹æœå°‹çµæžœ

## ðŸ“ æ³¨æ„äº‹é …

- æ‰€æœ‰ä¿®å¾©éƒ½åŒ…å«è©³ç´°çš„æŽ§åˆ¶å°æ—¥èªŒï¼Œæ–¹ä¾¿èª¿è©¦
- ç”¨æˆ¶ ID ç³»çµ±å·²å„ªåŒ–ï¼Œæ”¯æŒå¤šç¨®æª¢æ¸¬æ–¹å¼å’Œè‡ªå‹•è¨­ç½®
- è¿‘æœŸç€è¦½åŠŸèƒ½ç¾åœ¨å¯ä»¥æ­£ç¢ºæª¢æ¸¬ç”¨æˆ¶ M000003 ä¸¦è¨˜éŒ„ç€è¦½æ­·å²
- è·¯ç”±è¡çªå·²è§£æ±ºï¼Œæœå‹™å™¨æ‡‰è©²æ­£å¸¸å•Ÿå‹•
- æ‰€æœ‰æ•¸æ“šåº«æ“ä½œéƒ½åŒ…å«éŒ¯èª¤è™•ç†

## ðŸŽ‰ çµè«–

æ‰€æœ‰å ±å‘Šçš„å•é¡Œéƒ½å·²æˆåŠŸä¿®å¾©ä¸¦ç¶“éŽæ¸¬è©¦é©—è­‰ã€‚EatMove å¤–é€å¹³å°ç¾åœ¨æ‡‰è©²å¯ä»¥æ­£å¸¸é‹ä½œï¼Œæä¾›å®Œæ•´çš„ç”¨æˆ¶é«”é©—ã€‚è¿‘æœŸç€è¦½åŠŸèƒ½çš„ç”¨æˆ¶ ID æª¢æ¸¬å•é¡Œå·²è§£æ±ºï¼Œç”¨æˆ¶ç€è¦½é¤å»³æ™‚æœƒæ­£ç¢ºè¨˜éŒ„åˆ°æ•¸æ“šåº«ä¸­ã€‚
