# EatMove 性能優化指南

## 🚀 本地開發性能優化

### 1. 清理專案檔案

已清理的檔案類型：

- ✅ 測試檔案 (`test-*.js`, `check-*.js`)
- ✅ 臨時文檔 (`*.html`, `*-report.md`)
- ✅ Next.js 快取 (`.next` 目錄)
- ✅ Node.js 快取

### 2. Next.js 配置優化

#### 已啟用的優化功能：

```javascript
// next.config.js 中的關鍵優化
{
  experimental: {
    turbo: true,           // 啟用 Turbopack
    optimizeFonts: true,   // 字體優化
    swcMinify: true        // SWC 編譯器
  },

  webpack: {
    cache: 'filesystem',   // 檔案系統快取
    watchOptions: {        // 監控優化
      poll: 1000,
      aggregateTimeout: 300
    }
  }
}
```

### 3. 開發環境優化步驟

#### 步驟 1: 重新安裝依賴

```bash
# 清理並重新安裝
npm ci
```

#### 步驟 2: 清理快取

```bash
# 清理 Next.js 快取
rm -rf .next

# 清理 npm 快取
npm cache clean --force
```

#### 步驟 3: 優化啟動

```bash
# 使用優化模式啟動
npm run dev
```

### 4. 系統層級優化

#### Windows 系統優化：

1. **關閉不必要的程式**

   - 關閉瀏覽器多餘分頁
   - 關閉其他開發工具
   - 暫停防毒軟體即時掃描

2. **增加虛擬記憶體**

   ```
   控制台 → 系統 → 進階系統設定 → 效能設定 → 進階 → 虛擬記憶體
   建議設定: 初始大小 4096MB，最大值 8192MB
   ```

3. **排除資料夾掃描**
   - 將專案資料夾加入防毒軟體排除清單
   - 排除 `node_modules` 和 `.next` 資料夾

#### 硬體建議：

- **RAM**: 至少 8GB，建議 16GB
- **SSD**: 使用 SSD 硬碟存放專案
- **CPU**: 多核心處理器效果更佳

### 5. 開發工具優化

#### VS Code 設定：

```json
// .vscode/settings.json
{
  "typescript.preferences.includePackageJsonAutoImports": "off",
  "typescript.suggest.autoImports": false,
  "files.watcherExclude": {
    "**/node_modules/**": true,
    "**/.next/**": true,
    "**/dist/**": true
  },
  "search.exclude": {
    "**/node_modules": true,
    "**/.next": true,
    "**/dist": true
  }
}
```

#### 瀏覽器優化：

- 使用 Chrome DevTools 的 Performance 分頁監控
- 啟用 React Developer Tools
- 關閉不必要的瀏覽器擴充功能

### 6. 程式碼層級優化

#### React 組件優化：

```typescript
// 使用 React.memo 避免不必要的重新渲染
const OptimizedComponent = React.memo(({ data }) => {
  return <div>{data}</div>;
});

// 使用 useMemo 快取計算結果
const expensiveValue = useMemo(() => {
  return heavyCalculation(data);
}, [data]);

// 使用 useCallback 快取函數
const handleClick = useCallback(() => {
  // 處理點擊
}, [dependency]);
```

#### 圖片優化：

```typescript
// 使用 Next.js Image 組件
import Image from "next/image";

<Image
  src="/image.jpg"
  alt="描述"
  width={500}
  height={300}
  priority={true} // 重要圖片優先載入
  placeholder="blur" // 模糊預載入
/>;
```

### 7. 資料庫連接優化

#### 連接池設定：

```typescript
// lib/db.ts
const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  max: 20, // 最大連接數
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 2000,
});
```

### 8. API 路由優化

#### 快取策略：

```typescript
// API 路由中使用快取
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const cacheKey = searchParams.toString();

  // 檢查快取
  const cached = cache.get(cacheKey);
  if (cached) {
    return NextResponse.json(cached);
  }

  // 查詢資料庫
  const data = await fetchData();

  // 設定快取
  cache.set(cacheKey, data, 300); // 5分鐘快取

  return NextResponse.json(data);
}
```

### 9. 監控和除錯

#### 性能監控工具：

```bash
# 安裝性能分析工具
npm install --save-dev @next/bundle-analyzer

# 分析 bundle 大小
npm run analyze
```

#### 開發時監控：

```typescript
// 監控組件渲染時間
const ComponentWithProfiling = () => {
  const startTime = performance.now();

  useEffect(() => {
    const endTime = performance.now();
    console.log(`組件渲染時間: ${endTime - startTime}ms`);
  });

  return <YourComponent />;
};
```

### 10. 常見問題解決

#### 問題 1: 首次載入緩慢

**解決方案：**

- 檢查網路連接
- 清理瀏覽器快取
- 重新啟動開發伺服器

#### 問題 2: 熱重載緩慢

**解決方案：**

```bash
# 減少監控的檔案
echo "node_modules/" >> .gitignore
echo ".next/" >> .gitignore
```

#### 問題 3: 記憶體使用過高

**解決方案：**

```bash
# 增加 Node.js 記憶體限制
export NODE_OPTIONS="--max-old-space-size=4096"
npm run dev
```

### 11. 效能基準測試

#### 目標指標：

- **首次載入**: < 3 秒
- **頁面切換**: < 1 秒
- **API 響應**: < 500ms
- **圖片載入**: < 2 秒

#### 測試命令：

```bash
# Lighthouse 測試
npx lighthouse http://localhost:3001 --view

# Bundle 分析
npm run build
npm run analyze
```

### 12. 持續優化建議

1. **定期清理**

   - 每週清理一次 `.next` 快取
   - 每月更新依賴套件
   - 定期檢查 bundle 大小

2. **監控指標**

   - 使用 Web Vitals 監控
   - 設定性能預算
   - 定期進行性能測試

3. **程式碼審查**
   - 檢查不必要的重新渲染
   - 優化資料庫查詢
   - 移除未使用的程式碼

---

## 🎯 快速優化檢查清單

- [ ] 清理臨時檔案和測試檔案
- [ ] 更新 Next.js 配置
- [ ] 重新安裝依賴 (`npm ci`)
- [ ] 清理快取 (`rm -rf .next`)
- [ ] 設定 VS Code 優化
- [ ] 配置瀏覽器開發工具
- [ ] 檢查系統資源使用
- [ ] 測試載入速度
- [ ] 監控記憶體使用
- [ ] 設定性能監控

執行這些步驟後，您的 EatMove 專案應該會有顯著的性能提升！
